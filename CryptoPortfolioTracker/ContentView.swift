//
//  ContentView.swift
//  CryptoPortfolioTracker
//
//  Created by Zhendong Chen on 12/25/23.
//
import Charts

import SwiftUI

//struct MonthlyHoursOfSunshine: Identifiable {
//    var id = UUID()
//    var date: Date
//    var hoursOfSunshine: Double
//
//    init(month: Int, hoursOfSunshine: Double) {
//        let calendar = Calendar.autoupdatingCurrent
//        self.date = calendar.date(from: DateComponents(year: 2020, month: month))!
//        self.hoursOfSunshine = hoursOfSunshine
//    }
//}



struct ContentView: View {
    let timer = Timer.publish(every: 60, on: .main, in: .common).autoconnect()
    
    @State var addresses: [String] = [Config.test_wallet]
    
    @State var walletsInfo: [WalletInfo] = []
    
    @State private var showingBottomMenu = false
    @State var showingImportWalletView = false
    
    @State var totalBalance: Double = 0
    
    @State private var walletsBalanceChart: [String: [[Double]]] = [:]
    
    @State private var totalBalanceChart = [[Double]]()
    
    @State private var istotalBalanceChartDataLoaded = false
    
    let tabs = ["LIVE", "1D", "1W", "3M", "All"]
    @State private var selectedTab = "All"
    
    
    var currentDate: String {
            let now = Date()
            let formatter = DateFormatter()
            formatter.dateStyle = .medium
            return formatter.string(from: now)
    }
    
    
    var body: some View {
        NavigationStack {
            ScrollView {
                VStack(alignment: .leading) {
                    // TODO: problem: Calling balance api too many times and UI is not matching
                    TotalBalanceView(balance: totalBalance)
                        .padding(.leading)
               

                    // Uncomment to code below
                    HStack(spacing: 3) {
                        Image(systemName: "arrowtriangle.up.fill")
                            .resizable()
                            .aspectRatio(contentMode: .fit)
                            .frame(width: 15, height: 15)
                            .foregroundColor(.green)

                        Text("$645.55")
                            .font(.subheadline)
                            .fontWeight(.semibold)

                        Text("(0.69%)")
                            .font(.subheadline)
                            .fontWeight(.semibold)

                        Text("Today")
                            .font(.subheadline)
                            .fontWeight(.light)

                        Spacer()

                    }
                
                    .padding(.leading)

                
                    switch selectedTab {
                    case "LIVE":
                        Text("LIVE")
                    case "1D":
                        Text("1D")
                    case "1W":
                        let currentDate = Date()
                        TotalBalanceChartView(totalBalanceChart: totalBalanceChart, timeBefore: Calendar.current.date(byAdding: .day, value: -7, to: currentDate))
                    case "3M":
                        
                        if istotalBalanceChartDataLoaded {
                            let currentDate = Date()
                            TotalBalanceChartView(totalBalanceChart: totalBalanceChart, timeBefore: Calendar.current.date(byAdding: .month, value: -3, to: currentDate))
                        }
                    case "All":
                        if istotalBalanceChartDataLoaded {
                            AllTimeBalanceChartView(totalBalanceChart: totalBalanceChart)
                        }
                    default:
                        Text("Defaualt")

                    }

                    
                    // Chart TabView
                    VStack {
                        HStack {
                            ForEach(tabs, id: \.self) { tab in
                                Button(action: {
                                    self.selectedTab = tab
                                }) {
                                    Spacer()
                                    VStack {
                                        Text(tab)
                                            .foregroundColor(self.selectedTab == tab ? .white : .green)
                                            .frame(width: 50, height: 30)
                                            .background(self.selectedTab == tab ? .green : .white)
                                            .cornerRadius(10)
                                            
                                    }
                                    Spacer()
                                }
                                
                            }
                        }
                    }

                    
                    
//                    HStack {
//                        Text(currentDate)
//                        Spacer()
//                    }
//                    .padding(.leading)
                    
                    HStack() {
                        Text("Accounts")
                            .font(.largeTitle)
                            .fontWeight(.semibold)
                        Spacer()
                    }
                    .padding(.leading)


                    if (istotalBalanceChartDataLoaded) {
                        ForEach(walletsInfo, id: \.id) { walletInfo in
                            NavigationLink(value: walletInfo) {
                                AccountCellView(walletInfo: walletInfo, walletsBalanceChart: walletsBalanceChart, istotalBalanceChartDataLoaded: istotalBalanceChartDataLoaded)
                                    .padding(.leading)
                            }
                        }
                    }

                }
                .navigationTitle("Total Balance")
   
            }
            .navigationDestination(for: WalletInfo.self) { walletInfo in
                AccountDetailView(walletInfo: walletInfo)
            }
            .navigationDestination(isPresented: $showingImportWalletView, destination: {ImportWalletView(addresses: $addresses, showingImportWalletView: $showingImportWalletView)})
            .toolbar {
                ToolbarItemGroup(placement: .navigationBarTrailing) {
           
                    Button(action: {
                        showingBottomMenu = true})
                    {
                        Image(systemName: "plus")
                            .foregroundColor(.green)
                            .font(.system(size: 20, weight: .bold))
                    }
                    .sheet(isPresented: $showingBottomMenu) {
                        BottomSheetView(navigateToImportWalletView: $showingImportWalletView, showingBottomMenu: $showingBottomMenu)
                            .padding()
                            .presentationDetents([.fraction(0.2)])
                            .presentationDragIndicator(.visible)
                    }
                }
            }
            .task {
                if walletsInfo.isEmpty {
                    totalBalance = 0
                    walletsInfo = []
                    do {
                        for address in addresses {
                            let walletInfo = try await fetchWalletInfo(walletAddress: address)
                            totalBalance += walletInfo.balanceInUSD
                            walletsInfo.append(walletInfo)
                        }
                    } catch APIError.invalidURL {
                        print("Invalid url")
                    } catch APIError.invalidResponse {
                        print("Invalid response")
                    } catch APIError.invalidData {
                        print("Invalid Data")
                    } catch {
                        // Handle other errors
                        print("An unexpected error")
                    }
                }
                // Get historical balance for all the wallets
                if walletsBalanceChart.isEmpty {
                    do {
                        for address in addresses {
                            let walletBalanceChart = try await fetchWalletHistoricalValueChart(walletAddress: address)
                            let lowerCaseAddress = address.lowercased()
                            walletsBalanceChart[lowerCaseAddress] = walletBalanceChart;
                        }
                        print(walletsBalanceChart)

                        totalBalanceChart = getHistoricalTotalValueChart(walletsBalanceChart: walletsBalanceChart)
                        // TODO: tmp
//                        totalBalanceChart = [
//                            [
//                                1702490449780,
//                                4984.469784557141
//                            ],
//                            [
//                                1702494008612,
//                                4945.558860890788
//                            ],
//                            [
//                                1702497627063,
//                                4980.725072886967
//                            ],
//                            [
//                                1702501248619,
//                                4957.740967448859
//                            ],
//                            [
//                                1702504817834,
//                                4965.820277076115
//                            ],
//                            [
//                                1702508404506,
//                                4959.139694204712
//                            ],
//                            [
//                                1702512013377,
//                                4968.201205607283
//                            ],
//                            [
//                                1702515652537,
//                                4958.808128424587
//                            ],
//                            [
//                                1702519202182,
//                                4995.28785538141
//                            ],
//                            [
//                                1702522809866,
//                                4966.040145131978
//                            ],
//                            [
//                                1702526440577,
//                                4958.5090166896725
//                            ],
//                            [
//                                1702530050639,
//                                4863.513513635591
//                            ],
//                            [
//                                1702533618459,
//                                4917.684223445085
//                            ],
//                            [
//                                1702537242578,
//                                4978.886795821985
//                            ],
//                            [
//                                1702540839682,
//                                5007.760987561174
//                            ],
//                            [
//                                1702544418837,
//                                5088.186528159838
//                            ],
//                            [
//                                1702548014679,
//                                5247.10336436424
//                            ],
//                            [
//                                1702551629891,
//                                5358.3638767309785
//                            ],
//                            [
//                                1702555234016,
//                                5480.5757354657835
//                            ],
//                            [
//                                1702558829541,
//                                5481.029110900181
//                            ],
//                            [
//                                1702562448166,
//                                5406.452607212932
//                            ],
//                            [
//                                1702566003109,
//                                5546.544893410556
//                            ],
//                            [
//                                1702569600772,
//                                5387.021681955232
//                            ],
//                            [
//                                1702573211361,
//                                12179.171492047648
//                            ],
//                            [
//                                1702576838378,
//                                12396.571509878908
//                            ],
//                            [
//                                1702580420760,
//                                12175.778678349358
//                            ],
//                            [
//                                1702584023864,
//                                12538.993903282226
//                            ],
//                            [
//                                1702587644378,
//                                12573.165095776232
//                            ],
//                            [
//                                1702591219202,
//                                12624.262722607715
//                            ],
//                            [
//                                1702594804670,
//                                12693.781361180703
//                            ],
//                            [
//                                1702598403023,
//                                12641.15914588272
//                            ],
//                            [
//                                1702602031995,
//                                12585.08854300611
//                            ],
//                            [
//                                1702605648075,
//                                12682.570398876083
//                            ],
//                            [
//                                1702609248004,
//                                12372.6655248513
//                            ],
//                            [
//                                1702612850695,
//                                12484.372946436746
//                            ],
//                            [
//                                1702616452694,
//                                12320.24242386347
//                            ],
//                            [
//                                1702620006054,
//                                12117.982493014722
//                            ],
//                            [
//                                1702623615939,
//                                12093.076274031813
//                            ],
//                            [
//                                1702627223408,
//                                11962.743618576686
//                            ],
//                            [
//                                1702630843589,
//                                11878.73029420899
//                            ],
//                            [
//                                1702634419756,
//                                12101.999180160157
//                            ],
//                            [
//                                1702638042001,
//                                12180.467919675522
//                            ],
//                            [
//                                1702641662406,
//                                12142.282507270871
//                            ],
//                            [
//                                1702645203944,
//                                12019.420590779187
//                            ],
//                            [
//                                1702648841677,
//                                11841.190876219183
//                            ],
//                            [
//                                1702652403528,
//                                11653.727491528229
//                            ],
//                            [
//                                1702656032422,
//                                11578.807276746076
//                            ],
//                            [
//                                1702659643548,
//                                11298.908093930528
//                            ],
//                            [
//                                1702663222580,
//                                11339.671210219636
//                            ],
//                            [
//                                1702666831647,
//                                11484.155148421902
//                            ],
//                            [
//                                1702670412984,
//                                11587.964906370216
//                            ],
//                            [
//                                1702674007027,
//                                11623.386137866328
//                            ],
//                            [
//                                1702677619321,
//                                11771.372851735388
//                            ],
//                            [
//                                1702681232789,
//                                11594.407183533584
//                            ],
//                            [
//                                1702684837855,
//                                11383.459690232143
//                            ],
//                            [
//                                1702688412434,
//                                11262.693265250517
//                            ],
//                            [
//                                1702692011552,
//                                11316.540154736174
//                            ],
//                            [
//                                1702695616665,
//                                11640.345971560953
//                            ],
//                            [
//                                1702699243024,
//                                11679.12534749093
//                            ],
//                            [
//                                1702702807900,
//                                11564.650384518201
//                            ],
//                            [
//                                1702706426798,
//                                11549.245991052385
//                            ],
//                            [
//                                1702710004552,
//                                11457.395130886447
//                            ],
//                            [
//                                1702713623664,
//                                11421.452596178135
//                            ],
//                            [
//                                1702717205432,
//                                11369.648778574712
//                            ],
//                            [
//                                1702720832519,
//                                11403.60421563235
//                            ],
//                            [
//                                1702724404088,
//                                11385.23674662651
//                            ],
//                            [
//                                1702728001782,
//                                11392.144531539478
//                            ],
//                            [
//                                1702731626831,
//                                11389.832281063327
//                            ],
//                            [
//                                1702735213481,
//                                11400.832298279995
//                            ],
//                            [
//                                1702738815314,
//                                11592.319021027057
//                            ],
//                            [
//                                1702742440511,
//                                11641.085732922696
//                            ],
//                            [
//                                1702746018653,
//                                11650.108856758394
//                            ],
//                            [
//                                1702749611208,
//                                11610.594586224528
//                            ],
//                            [
//                                1702753230022,
//                                11545.523759479072
//                            ],
//                            [
//                                1702756810229,
//                                10776.548757581477
//                            ],
//                            [
//                                1702760409011,
//                                10743.05742798995
//                            ],
//                            [
//                                1702764004216,
//                                10723.132466520647
//                            ],
//                            [
//                                1702767604497,
//                                10765.708933814025
//                            ],
//                            [
//                                1702771241213,
//                                10815.256292198608
//                            ],
//                            [
//                                1702774857482,
//                                10955.76143817366
//                            ],
//                            [
//                                1702778424863,
//                                10915.880351842718
//                            ],
//                            [
//                                1702782036510,
//                                10841.453955168929
//                            ],
//                            [
//                                1702785618803,
//                                10903.39569021119
//                            ],
//                            [
//                                1702789217471,
//                                11084.228433571556
//                            ],
//                            [
//                                1702792824609,
//                                10979.272379131398
//                            ],
//                            [
//                                1702796443519,
//                                11024.473446001213
//                            ],
//                            [
//                                1702800030178,
//                                11245.05739966361
//                            ],
//                            [
//                                1702803626250,
//                                11335.17808768851
//                            ],
//                            [
//                                1702807212127,
//                                11362.10374144516
//                            ],
//                            [
//                                1702810804828,
//                                11364.23258239976
//                            ],
//                            [
//                                1702814403842,
//                                11105.981764630587
//                            ],
//                            [
//                                1702818085346,
//                                11222.423707644994
//                            ],
//                            [
//                                1702821606064,
//                                11158.63312376909
//                            ],
//                            [
//                                1702825225356,
//                                10977.372381739893
//                            ],
//                            [
//                                1702828806876,
//                                11047.424377796651
//                            ],
//                            [
//                                1702832452581,
//                                11004.763253281548
//                            ],
//                            [
//                                1702836041173,
//                                11013.488494365334
//                            ],
//                            [
//                                1702839607302,
//                                10882.626831774658
//                            ],
//                            [
//                                1702843251936,
//                                10945.964655126707
//                            ],
//                            [
//                                1702846800856,
//                                10904.299955947332
//                            ],
//                            [
//                                1702850453495,
//                                10735.655802626785
//                            ],
//                            [
//                                1702854066481,
//                                10597.355863805942
//                            ],
//                            [
//                                1702857616233,
//                                10440.324116956803
//                            ],
//                            [
//                                1702861209294,
//                                10323.401633794776
//                            ],
//                            [
//                                1702864809878,
//                                10257.23101226888
//                            ],
//                            [
//                                1702868418551,
//                                9746.041874443777
//                            ],
//                            [
//                                1702872015582,
//                                9700.312562022807
//                            ],
//                            [
//                                1702875611690,
//                                10047.522088243373
//                            ],
//                            [
//                                1702879231110,
//                                9932.6674206616
//                            ],
//                            [
//                                1702882846640,
//                                9782.17015322769
//                            ],
//                            [
//                                1702886404268,
//                                9809.275145643916
//                            ],
//                            [
//                                1702890028274,
//                                9660.647749757076
//                            ],
//                            [
//                                1702893667443,
//                                9641.846510345715
//                            ],
//                            [
//                                1702897247096,
//                                9600.69890005325
//                            ],
//                            [
//                                1702900815419,
//                                9695.033943774024
//                            ],
//                            [
//                                1702904431230,
//                                9581.410386138092
//                            ],
//                            [
//                                1702908021863,
//                                9843.243636494208
//                            ],
//                            [
//                                1702911608868,
//                                10385.862030042934
//                            ],
//                            [
//                                1702915257130,
//                                9830.547340353485
//                            ],
//                            [
//                                1702918806077,
//                                9895.132894182456
//                            ],
//                            [
//                                1702922408427,
//                                10242.87838098643
//                            ],
//                            [
//                                1702926048162,
//                                10297.265413501613
//                            ],
//                            [
//                                1702929609391,
//                                10340.16641350932
//                            ],
//                            [
//                                1702933228954,
//                                10711.774180651379
//                            ],
//                            [
//                                1702936834811,
//                                10950.543250703751
//                            ],
//                            [
//                                1702940403715,
//                                10980.614965610022
//                            ],
//                            [
//                                1702944037179,
//                                10855.908887771595
//                            ],
//                            [
//                                1702947655188,
//                                10897.657373089958
//                            ],
//                            [
//                                1702951241222,
//                                11248.066060066336
//                            ],
//                            [
//                                1702954840482,
//                                11574.196145857057
//                            ],
//                            [
//                                1702958425715,
//                                11731.33153345748
//                            ],
//                            [
//                                1702962038145,
//                                11437.261092494757
//                            ],
//                            [
//                                1702965650855,
//                                11230.9180414546
//                            ],
//                            [
//                                1702969251917,
//                                11205.027486085857
//                            ],
//                            [
//                                1702972848206,
//                                11242.635855924287
//                            ],
//                            [
//                                1702976477496,
//                                11331.16961834206
//                            ],
//                            [
//                                1702980028968,
//                                11003.980098828193
//                            ],
//                            [
//                                1702983642093,
//                                10704.729760165463
//                            ],
//                            [
//                                1702987200658,
//                                10685.671118943326
//                            ],
//                            [
//                                1702990807851,
//                                10763.367789265183
//                            ],
//                            [
//                                1702994496466,
//                                10709.102116392512
//                            ],
//                            [
//                                1702998041299,
//                                10440.655337013413
//                            ],
//                            [
//                                1703001647980,
//                                10274.298237747827
//                            ],
//                            [
//                                1703005215536,
//                                10223.724346632147
//                            ],
//                            [
//                                1703008845893,
//                                9947.066750206994
//                            ],
//                            [
//                                1703012430392,
//                                9658.055434476702
//                            ],
//                            [
//                                1703016091970,
//                                9855.514327080715
//                            ],
//                            [
//                                1703019602842,
//                                9928.283067708484
//                            ],
//                            [
//                                1703023257434,
//                                9531.568543339554
//                            ],
//                            [
//                                1703026820736,
//                                9780.14978752345
//                            ],
//                            [
//                                1703030418705,
//                                9826.127187613492
//                            ],
//                            [
//                                1703034005010,
//                                10288.99339436762
//                            ],
//                            [
//                                1703037608960,
//                                10228.648322322812
//                            ],
//                            [
//                                1703041264344,
//                                10310.502697271213
//                            ],
//                            [
//                                1703044816065,
//                                10183.087694624139
//                            ],
//                            [
//                                1703048455546,
//                                10184.444793244711
//                            ],
//                            [
//                                1703052017513,
//                                10156.923650492048
//                            ],
//                            [
//                                1703055623257,
//                                10283.195213904306
//                            ],
//                            [
//                                1703059242973,
//                                10298.947900935718
//                            ],
//                            [
//                                1703062863081,
//                                10020.316129356375
//                            ],
//                            [
//                                1703066445975,
//                                9830.76380592818
//                            ],
//                            [
//                                1703070002283,
//                                9201.87027633189
//                            ],
//                            [
//                                1703073639819,
//                                9548.912289020576
//                            ],
//                            [
//                                1703077263815,
//                                9519.889196874165
//                            ],
//                            [
//                                1703080806044,
//                                9462.897558311357
//                            ],
//                            [
//                                1703084405959,
//                                9689.186240608802
//                            ],
//                            [
//                                1703088045587,
//                                9778.077899621912
//                            ],
//                            [
//                                1703091663072,
//                                9415.857859671607
//                            ],
//                            [
//                                1703095251408,
//                                9289.388863260816
//                            ],
//                            [
//                                1703098801582,
//                                9161.18353796882
//                            ],
//                            [
//                                1703102408260,
//                                8792.720757358245
//                            ],
//                            [
//                                1703106031283,
//                                8716.14781326795
//                            ],
//                            [
//                                1703109618980,
//                                8863.63384406199
//                            ],
//                            [
//                                1703113250257,
//                                9210.868714030219
//                            ],
//                            [
//                                1703116856695,
//                                9463.243904707298
//                            ],
//                            [
//                                1703120501082,
//                                11179.993541894291
//                            ],
//                            [
//                                1703124036303,
//                                11457.630310245568
//                            ],
//                            [
//                                1703127620319,
//                                11455.628615579168
//                            ],
//                            [
//                                1703131223775,
//                                10982.6010631557
//                            ],
//                            [
//                                1703134812988,
//                                10921.01073685548
//                            ],
//                            [
//                                1703138433524,
//                                11276.538996108422
//                            ],
//                            [
//                                1703142012618,
//                                11285.605962952612
//                            ],
//                            [
//                                1703145682121,
//                                11223.48575074233
//                            ],
//                            [
//                                1703149207171,
//                                11206.250162359975
//                            ],
//                            [
//                                1703152837826,
//                                10823.451247172437
//                            ],
//                            [
//                                1703156450565,
//                                11134.942089740058
//                            ],
//                            [
//                                1703160048982,
//                                10897.7616096778
//                            ],
//                            [
//                                1703163663088,
//                                10991.826059720745
//                            ],
//                            [
//                                1703167223452,
//                                11038.577823177622
//                            ],
//                            [
//                                1703170830101,
//                                10809.794362851806
//                            ],
//                            [
//                                1703174403018,
//                                10857.671182412027
//                            ],
//                            [
//                                1703178031582,
//                                10830.046552831247
//                            ],
//                            [
//                                1703181627642,
//                                10197.97253644537
//                            ],
//                            [
//                                1703185237936,
//                                10325.182236448594
//                            ],
//                            [
//                                1703188862077,
//                                10319.684297001253
//                            ],
//                            [
//                                1703192409033,
//                                10688.388835804057
//                            ],
//                            [
//                                1703196016825,
//                                11046.649202324954
//                            ],
//                            [
//                                1703199619329,
//                                11458.993716369248
//                            ],
//                            [
//                                1703203232285,
//                                11401.796618820446
//                            ],
//                            [
//                                1703206902391,
//                                11421.230779615025
//                            ],
//                            [
//                                1703210446220,
//                                11507.333942707686
//                            ],
//                            [
//                                1703214069677,
//                                12083.105344828198
//                            ],
//                            [
//                                1703217605387,
//                                12715.556990921632
//                            ],
//                            [
//                                1703221238938,
//                                12073.275443081728
//                            ],
//                            [
//                                1703224811032,
//                                12164.57300653279
//                            ],
//                            [
//                                1703228411567,
//                                12103.666662933772
//                            ],
//                            [
//                                1703232001003,
//                                12093.567291485986
//                            ],
//                            [
//                                1703235612296,
//                                11874.101172041159
//                            ],
//                            [
//                                1703239272092,
//                                12154.153913025948
//                            ],
//                            [
//                                1703242813136,
//                                12126.075147602298
//                            ],
//                            [
//                                1703246459719,
//                                11859.238959866238
//                            ],
//                            [
//                                1703250056795,
//                                11655.73001245263
//                            ],
//                            [
//                                1703253604115,
//                                11268.415058426031
//                            ],
//                            [
//                                1703257221927,
//                                11189.742786969697
//                            ],
//                            [
//                                1703260815490,
//                                11098.45739850198
//                            ],
//                            [
//                                1703264410296,
//                                11013.588866524526
//                            ],
//                            [
//                                1703268071304,
//                                10991.39581886613
//                            ],
//                            [
//                                1703271693168,
//                                11001.54483147123
//                            ],
//                            [
//                                1703275217432,
//                                11047.139391507473
//                            ],
//                            [
//                                1703278886103,
//                                11021.31275003984
//                            ],
//                            [
//                                1703282422808,
//                                11047.025885420762
//                            ],
//                            [
//                                1703286023979,
//                                11086.408717009783
//                            ],
//                            [
//                                1703289731025,
//                                11135.054878728073
//                            ],
//                            [
//                                1703293310726,
//                                10964.099705174785
//                            ],
//                            [
//                                1703296830200,
//                                10955.388378570271
//                            ],
//                            [
//                                1703300432901,
//                                10926.388822402543
//                            ],
//                            [
//                                1703304017908,
//                                10900.28244707164
//                            ],
//                            [
//                                1703307662114,
//                                10868.351100809685
//                            ],
//                            [
//                                1703311202515,
//                                10957.78375354941
//                            ],
//                            [
//                                1703314818002,
//                                10994.974731928452
//                            ],
//                            [
//                                1703318406985,
//                                11220.761824005243
//                            ],
//                            [
//                                1703322015135,
//                                11285.030898999776
//                            ],
//                            [
//                                1703325623150,
//                                11292.972417873272
//                            ],
//                            [
//                                1703329230456,
//                                11037.123526222347
//                            ],
//                            [
//                                1703332808401,
//                                11071.364542856965
//                            ],
//                            [
//                                1703336437807,
//                                11065.740050619717
//                            ],
//                            [
//                                1703340022805,
//                                11064.720354235524
//                            ],
//                            [
//                                1703343633461,
//                                11076.529184245892
//                            ],
//                            [
//                                1703347211999,
//                                10843.143212078234
//                            ],
//                            [
//                                1703350819722,
//                                10859.075631767546
//                            ],
//                            [
//                                1703354506640,
//                                10818.321640417204
//                            ],
//                            [
//                                1703358030717,
//                                10781.897442769385
//                            ],
//                            [
//                                1703361629153,
//                                11064.105765046548
//                            ],
//                            [
//                                1703365202614,
//                                11074.52876420649
//                            ],
//                            [
//                                1703368836309,
//                                11041.924687551325
//                            ],
//                            [
//                                1703372415042,
//                                10943.55605975381
//                            ],
//                            [
//                                1703376061254,
//                                11254.407903997442
//                            ],
//                            [
//                                1703379615201,
//                                11217.27015674189
//                            ],
//                            [
//                                1703383240991,
//                                11328.261428453254
//                            ],
//                            [
//                                1703386811954,
//                                11363.895165397214
//                            ],
//                            [
//                                1703390434274,
//                                11457.055349117816
//                            ],
//                            [
//                                1703394041169,
//                                11389.433423520532
//                            ],
//                            [
//                                1703397650243,
//                                11273.567082916865
//                            ],
//                            [
//                                1703401228120,
//                                11217.569127765297
//                            ],
//                            [
//                                1703404849236,
//                                11234.826593189546
//                            ],
//                            [
//                                1703408423952,
//                                11146.614593896358
//                            ],
//                            [
//                                1703412050041,
//                                11236.290653043097
//                            ],
//                            [
//                                1703415641414,
//                                11168.085006034025
//                            ],
//                            [
//                                1703419236136,
//                                11072.936307883601
//                            ],
//                            [
//                                1703422818675,
//                                11110.481399447532
//                            ],
//                            [
//                                1703426436725,
//                                11104.010420685423
//                            ],
//                            [
//                                1703430016345,
//                                11064.068429893478
//                            ],
//                            [
//                                1703433634060,
//                                11091.008946537424
//                            ],
//                            [
//                                1703437217209,
//                                10976.897090250553
//                            ],
//                            [
//                                1703440837328,
//                                10700.887539471387
//                            ],
//                            [
//                                1703444463495,
//                                10611.348077150513
//                            ],
//                            [
//                                1703448033154,
//                                10494.875112347128
//                            ],
//                            [
//                                1703451649021,
//                                10377.157481636572
//                            ],
//                            [
//                                1703455245437,
//                                10341.474077917044
//                            ],
//                            [
//                                1703458835618,
//                                10301.665133816394
//                            ],
//                            [
//                                1703462403600,
//                                10361.48286404068
//                            ],
//                            [
//                                1703466001253,
//                                10271.195616278881
//                            ],
//                            [
//                                1703469616918,
//                                10408.800545633421
//                            ],
//                            [
//                                1703473209784,
//                                10645.9566475955
//                            ],
//                            [
//                                1703476828519,
//                                10793.2420786942
//                            ],
//                            [
//                                1703480405070,
//                                10799.630892985071
//                            ],
//                            [
//                                1703484013922,
//                                11034.422068279944
//                            ],
//                            [
//                                1703487615186,
//                                10858.470472834037
//                            ],
//                            [
//                                1703491233755,
//                                10862.267508679428
//                            ],
//                            [
//                                1703494847464,
//                                10857.216948620951
//                            ],
//                            [
//                                1703498408508,
//                                10828.026529727511
//                            ],
//                            [
//                                1703502027748,
//                                10902.979669213404
//                            ],
//                            [
//                                1703505617982,
//                                10822.965677049006
//                            ],
//                            [
//                                1703509260451,
//                                10876.005275397809
//                            ],
//                            [
//                                1703512819620,
//                                10763.683454778624
//                            ],
//                            [
//                                1703516412099,
//                                10738.628626868134
//                            ],
//                            [
//                                1703520016675,
//                                10780.516943466604
//                            ],
//                            [
//                                1703523653919,
//                                10800.288888633564
//                            ],
//                            [
//                                1703527267018,
//                                10842.61845564376
//                            ],
//                            [
//                                1703530825982,
//                                11296.31505157903
//                            ],
//                            [
//                                1703534413023,
//                                11266.255528865937
//                            ],
//                            [
//                                1703538037140,
//                                11118.607230292673
//                            ],
//                            [
//                                1703541649643,
//                                11315.070692527734
//                            ],
//                            [
//                                1703545230666,
//                                11423.248672270338
//                            ],
//                            [
//                                1703548846618,
//                                11591.436838924808
//                            ],
//                            [
//                                1703552440026,
//                                11420.804683080558
//                            ],
//                            [
//                                1703556076047,
//                                11482.872207866374
//                            ],
//                            [
//                                1703559628515,
//                                11454.947730521155
//                            ],
//                            [
//                                1703563274787,
//                                11283.779708646134
//                            ],
//                            [
//                                1703566833409,
//                                11211.357168785946
//                            ],
//                            [
//                                1703570428229,
//                                11147.328801712418
//                            ],
//                            [
//                                1703574091416,
//                                10994.553098316701
//                            ],
//                            [
//                                1703577655372,
//                                11073.796728358473
//                            ],
//                            [
//                                1703581234446,
//                                10933.360706643281
//                            ],
//                            [
//                                1703584862531,
//                                10998.609609100618
//                            ],
//                            [
//                                1703588463048,
//                                11159.370078492835
//                            ],
//                            [
//                                1703592093204,
//                                11264.035679271077
//                            ],
//                            [
//                                1703595621287,
//                                10983.45976016989
//                            ],
//                            [
//                                1703599225787,
//                                10991.04572163536
//                            ],
//                            [
//                                1703602856150,
//                                10914.348919014661
//                            ],
//                            [
//                                1703606466271,
//                                10580.719940480922
//                            ],
//                            [
//                                1703610035107,
//                                10421.719398741056
//                            ],
//                            [
//                                1703613626409,
//                                10247.379702575361
//                            ],
//                            [
//                                1703617207414,
//                                10334.882915196078
//                            ],
//                            [
//                                1703620849490,
//                                10417.86918456497
//                            ],
//                            [
//                                1703624469846,
//                                10414.49696144477
//                            ],
//                            [
//                                1703628045312,
//                                10414.127027145532
//                            ],
//                            [
//                                1703631641597,
//                                10510.723703693822
//                            ],
//                            [
//                                1703635237522,
//                                10497.713983230267
//                            ],
//                            [
//                                1703638886627,
//                                10551.097488772455
//                            ],
//                            [
//                                1703642458162,
//                                10580.162155623311
//                            ],
//                            [
//                                1703646012656,
//                                10566.081421832518
//                            ],
//                            [
//                                1703649636879,
//                                10694.519943326673
//                            ],
//                            [
//                                1703653215356,
//                                10688.952384078477
//                            ],
//                            [
//                                1703656873040,
//                                10567.932225421237
//                            ],
//                            [
//                                1703660462001,
//                                10671.354669096248
//                            ],
//                            [
//                                1703664046926,
//                                10806.1256138284
//                            ],
//                            [
//                                1703667631591,
//                                10917.457607598151
//                            ],
//                            [
//                                1703671215662,
//                                10837.037847992331
//                            ],
//                            [
//                                1703674833607,
//                                10935.777033587705
//                            ],
//                            [
//                                1703678433503,
//                                11032.484393005898
//                            ],
//                            [
//                                1703682106059,
//                                10954.538597721788
//                            ],
//                            [
//                                1703685701654,
//                                11038.860061819976
//                            ],
//                            [
//                                1703689225157,
//                                11128.494036627077
//                            ],
//                            [
//                                1703692882234,
//                                11689.864293188146
//                            ],
//                            [
//                                1703696460364,
//                                11983.499841975285
//                            ],
//                            [
//                                1703700019407,
//                                14343.982396684618
//                            ],
//                            [
//                                1703703616666,
//                                14230.020255954812
//                            ],
//                            [
//                                1703707238034,
//                                14421.295887012046
//                            ],
//                            [
//                                1703710828371,
//                                14891.807951233091
//                            ],
//                            [
//                                1703714426414,
//                                14998.419206032067
//                            ],
//                            [
//                                1703718030698,
//                                15525.566716582915
//                            ],
//                            [
//                                1703721683351,
//                                15307.620917876156
//                            ],
//                            [
//                                1703725272654,
//                                15338.96320752832
//                            ],
//                            [
//                                1703728822788,
//                                14765.862454538104
//                            ],
//                            [
//                                1703732478179,
//                                15036.82053880161
//                            ],
//                            [
//                                1703736045483,
//                                14846.39237993341
//                            ],
//                            [
//                                1703739619050,
//                                14901.364138368022
//                            ],
//                            [
//                                1703743271150,
//                                14791.181736192713
//                            ],
//                            [
//                                1703746808415,
//                                14677.850033455366
//                            ],
//                            [
//                                1703750473499,
//                                14599.292593368515
//                            ],
//                            [
//                                1703754011507,
//                                14374.964721769875
//                            ],
//                            [
//                                1703757652032,
//                                14343.97799920354
//                            ],
//                            [
//                                1703761246531,
//                                14532.499725366695
//                            ],
//                            [
//                                1703764843093,
//                                14625.842848686038
//                            ],
//                            [
//                                1703768430430,
//                                14349.024191747216
//                            ],
//                            [
//                                1703772019595,
//                                14396.488037603574
//                            ],
//                            [
//                                1703775656102,
//                                14203.315098289022
//                            ],
//                            [
//                                1703779236149,
//                                14185.101812150335
//                            ],
//                            [
//                                1703782810643,
//                                14456.933341814736
//                            ],
//                            [
//                                1703786434157,
//                                14324.99481829776
//                            ],
//                            [
//                                1703790029866,
//                                14425.109216721961
//                            ],
//                            [
//                                1703793641665,
//                                14514.595526050418
//                            ],
//                            [
//                                1703797217195,
//                                14578.03715843026
//                            ],
//                            [
//                                1703800845681,
//                                14448.890288766921
//                            ],
//                            [
//                                1703804411246,
//                                14557.440443708887
//                            ],
//                            [
//                                1703808027993,
//                                14619.627002433012
//                            ],
//                            [
//                                1703811619756,
//                                14659.398001394544
//                            ],
//                            [
//                                1703815282578,
//                                14305.494695709116
//                            ],
//                            [
//                                1703818807121,
//                                14190.257712876653
//                            ],
//                            [
//                                1703822430346,
//                                13810.237366925514
//                            ],
//                            [
//                                1703826036960,
//                                14265.656315899421
//                            ],
//                            [
//                                1703829630075,
//                                14111.53635272028
//                            ],
//                            [
//                                1703833228123,
//                                14227.810431076565
//                            ],
//                            [
//                                1703836846654,
//                                14133.971345504346
//                            ],
//                            [
//                                1703840426472,
//                                14173.107455126617
//                            ],
//                            [
//                                1703844060949,
//                                14329.19937227059
//                            ],
//                            [
//                                1703847688502,
//                                14555.432300276581
//                            ],
//                            [
//                                1703851230072,
//                                14584.877607276407
//                            ],
//                            [
//                                1703854829302,
//                                14363.5065845965
//                            ],
//                            [
//                                1703858446131,
//                                14300.039008193335
//                            ],
//                            [
//                                1703862014014,
//                                14294.819615843562
//                            ],
//                            [
//                                1703865653589,
//                                14052.017828421554
//                            ],
//                            [
//                                1703869254199,
//                                13745.890962726837
//                            ],
//                            [
//                                1703872845236,
//                                13689.07878773604
//                            ],
//                            [
//                                1703876429034,
//                                13768.575617113762
//                            ],
//                            [
//                                1703880045804,
//                                13866.328890752335
//                            ],
//                            [
//                                1703883639980,
//                                13716.753242744757
//                            ],
//                            [
//                                1703887272761,
//                                13751.152502487143
//                            ],
//                            [
//                                1703890803026,
//                                13758.309683356354
//                            ],
//                            [
//                                1703894432728,
//                                13860.47768102368
//                            ],
//                            [
//                                1703898039637,
//                                13894.393736025982
//                            ],
//                            [
//                                1703901621340,
//                                14168.469192008888
//                            ],
//                            [
//                                1703905257418,
//                                14396.023251842387
//                            ],
//                            [
//                                1703908846506,
//                                14832.466495086095
//                            ],
//                            [
//                                1703912421168,
//                                14725.154511805435
//                            ],
//                            [
//                                1703916051678,
//                                14639.719405076748
//                            ],
//                            [
//                                1703919602502,
//                                14657.85270711339
//                            ],
//                            [
//                                1703923214680,
//                                14659.485838757311
//                            ],
//                            [
//                                1703926824594,
//                                14579.65222686904
//                            ],
//                            [
//                                1703930496445,
//                                14426.63815458787
//                            ],
//                            [
//                                1703934006366,
//                                14436.459391082604
//                            ],
//                            [
//                                1703937638391,
//                                14297.766017843083
//                            ],
//                            [
//                                1703941214195,
//                                14396.748325714003
//                            ],
//                            [
//                                1703944841798,
//                                14371.305411596648
//                            ],
//                            [
//                                1703948421462,
//                                14343.470962647263
//                            ],
//                            [
//                                1703952069752,
//                                14484.42191320649
//                            ],
//                            [
//                                1703955620546,
//                                14513.860433099446
//                            ],
//                            [
//                                1703959227605,
//                                14748.706870291016
//                            ],
//                            [
//                                1703962818659,
//                                14955.169757344958
//                            ],
//                            [
//                                1703966461641,
//                                15093.551197152565
//                            ],
//                            [
//                                1703970021448,
//                                15212.583772200587
//                            ],
//                            [
//                                1703973682557,
//                                15290.188089464546
//                            ],
//                            [
//                                1703977322093,
//                                14764.848738982018
//                            ],
//                            [
//                                1703980836147,
//                                14707.78109049884
//                            ],
//                            [
//                                1703984469152,
//                                14567.85420593444
//                            ],
//                            [
//                                1703988071873,
//                                14579.56766575384
//                            ],
//                            [
//                                1703991693595,
//                                14543.71180290868
//                            ],
//                            [
//                                1703995222950,
//                                14430.963082468656
//                            ],
//                            [
//                                1703998878581,
//                                14636.799377841777
//                            ],
//                            [
//                                1704002470829,
//                                14749.99840148751
//                            ],
//                            [
//                                1704006050320,
//                                14812.14672353536
//                            ],
//                            [
//                                1704009638835,
//                                14935.78090072193
//                            ],
//                            [
//                                1704013276550,
//                                14961.53933460947
//                            ],
//                            [
//                                1704016876738,
//                                15113.106095496476
//                            ],
//                            [
//                                1704020421605,
//                                15074.400742454112
//                            ],
//                            [
//                                1704024007629,
//                                15072.992242524482
//                            ],
//                            [
//                                1704027631320,
//                                15056.95600868104
//                            ],
//                            [
//                                1704031273563,
//                                15296.816453822325
//                            ],
//                            [
//                                1704034857032,
//                                15474.755752648603
//                            ],
//                            [
//                                1704038428897,
//                                15385.207631518357
//                            ],
//                            [
//                                1704042026878,
//                                15696.422606411437
//                            ],
//                            [
//                                1704045643705,
//                                15834.263982160533
//                            ],
//                            [
//                                1704049273041,
//                                15885.836366763422
//                            ],
//                            [
//                                1704052813477,
//                                15871.973138434678
//                            ],
//                            [
//                                1704056434272,
//                                15691.891854245545
//                            ],
//                            [
//                                1704060082327,
//                                15716.128316427228
//                            ],
//                            [
//                                1704063641828,
//                                15698.016518058595
//                            ],
//                            [
//                                1704067239509,
//                                15637.514728394352
//                            ],
//                            [
//                                1704070845575,
//                                15699.596268963036
//                            ],
//                            [
//                                1704074440976,
//                                15825.543794771012
//                            ],
//                            [
//                                1704078041398,
//                                15743.589950425727
//                            ],
//                            [
//                                1704081615555,
//                                15728.951097341647
//                            ],
//                            [
//                                1704085232725,
//                                15701.503957272622
//                            ],
//                            [
//                                1704088876922,
//                                15719.261369158708
//                            ],
//                            [
//                                1704092470581,
//                                15735.663873072377
//                            ],
//                            [
//                                1704096005504,
//                                15859.696044492961
//                            ],
//                            [
//                                1704099657073,
//                                15844.387460386588
//                            ],
//                            [
//                                1704103206162,
//                                16180.783574182253
//                            ],
//                            [
//                                1704106843936,
//                                16259.035680469722
//                            ],
//                            [
//                                1704110417516,
//                                16214.480024214245
//                            ],
//                            [
//                                1704114017524,
//                                16203.60784935393
//                            ],
//                            [
//                                1704117658937,
//                                16215.311474385484
//                            ],
//                            [
//                                1704121244929,
//                                15757.832438535865
//                            ],
//                            [
//                                1704124840513,
//                                15828.808627553442
//                            ],
//                            [
//                                1704128413794,
//                                16152.039075095181
//                            ],
//                            [
//                                1704132043034,
//                                16402.120217878655
//                            ],
//                            [
//                                1704135627951,
//                                16470.32142435293
//                            ],
//                            [
//                                1704139210485,
//                                16650.38555796804
//                            ],
//                            [
//                                1704142863296,
//                                16638.23379460272
//                            ],
//                            [
//                                1704146425180,
//                                16841.485439745647
//                            ],
//                            [
//                                1704150001288,
//                                17588.50827562861
//                            ],
//                            [
//                                1704153608836,
//                                17399.545658472936
//                            ],
//                            [
//                                1704157220143,
//                                17613.203848347795
//                            ],
//                            [
//                                1704160863098,
//                                17523.965753271164
//                            ],
//                            [
//                                1704164440533,
//                                17974.419744420902
//                            ],
//                            [
//                                1704168123059,
//                                18706.25721773165
//                            ],
//                            [
//                                1704171652899,
//                                18298.016819302095
//                            ],
//                            [
//                                1704175249892,
//                                18438.800353875962
//                            ],
//                            [
//                                1704178856301,
//                                18563.929826514053
//                            ],
//                            [
//                                1704182412753,
//                                18917.014974878428
//                            ],
//                            [
//                                1704186034917,
//                                19288.41856328486
//                            ],
//                            [
//                                1704189628065,
//                                19500.825372491247
//                            ],
//                            [
//                                1704193257613,
//                                19052.230150789954
//                            ],
//                            [
//                                1704196812845,
//                                18477.085924026862
//                            ],
//                            [
//                                1704200422853,
//                                18789.779430805702
//                            ],
//                            [
//                                1704204068434,
//                                18664.29720818022
//                            ],
//                            [
//                                1704207665832,
//                                17795.549300084
//                            ],
//                            [
//                                1704211234510,
//                                17112.02963325602
//                            ],
//                            [
//                                1704214818356,
//                                17591.016752917483
//                            ],
//                            [
//                                1704218460176,
//                                17072.03229701856
//                            ],
//                            [
//                                1704222006789,
//                                17563.859353159318
//                            ],
//                            [
//                                1704225667422,
//                                17812.60511770529
//                            ],
//                            [
//                                1704229246734,
//                                17899.698726059574
//                            ],
//                            [
//                                1704232900668,
//                                17390.358528616456
//                            ],
//                            [
//                                1704236411155,
//                                17296.375378019235
//                            ],
//                            [
//                                1704240052513,
//                                17398.580437841967
//                            ],
//                            [
//                                1704243662974,
//                                17705.81108021343
//                            ],
//                            [
//                                1704247205572,
//                                18106.621948192034
//                            ],
//                            [
//                                1704250836300,
//                                18848.20356252396
//                            ],
//                            [
//                                1704254431447,
//                                20021.89111412938
//                            ],
//                            [
//                                1704258025725,
//                                19848.3772805481
//                            ],
//                            [
//                                1704261648977,
//                                20193.17685489501
//                            ],
//                            [
//                                1704265275956,
//                                21068.60487819147
//                            ],
//                            [
//                                1704268805242,
//                                19801.933517348123
//                            ],
//                            [
//                                1704272466409,
//                                20280.628659632253
//                            ],
//                            [
//                                1704276140326,
//                                20755.161858372016
//                            ],
//                            [
//                                1704279695235,
//                                20335.180400919733
//                            ],
//                            [
//                                1704283217639,
//                                18850.26205517809
//                            ],
//                            [
//                                1704286804844,
//                                17863.721223743425
//                            ],
//                            [
//                                1704290506805,
//                                19179.04188704748
//                            ],
//                            [
//                                1704294056600,
//                                19232.252307230883
//                            ],
//                            [
//                                1704297647674,
//                                19783.193999255804
//                            ],
//                            [
//                                1704301259894,
//                                19772.737175021157
//                            ],
//                            [
//                                1704304890974,
//                                19698.667274047966
//                            ],
//                            [
//                                1704308546158,
//                                19213.71291368288
//                            ],
//                            [
//                                1704312034732,
//                                19639.03428050872
//                            ],
//                            [
//                                1704315638642,
//                                19633.052292191704
//                            ],
//                            [
//                                1704319239930,
//                                19835.499728449286
//                            ],
//                            [
//                                1704322806354,
//                                19862.313006255034
//                            ],
//                            [
//                                1704326500556,
//                                19476.380913510584
//                            ],
//                            [
//                                1704330081184,
//                                19587.13666892552
//                            ],
//                            [
//                                1704333692186,
//                                19762.58728818168
//                            ],
//                            [
//                                1704337265407,
//                                20242.443610881623
//                            ],
//                            [
//                                1704340876855,
//                                19868.141413214504
//                            ],
//                            [
//                                1704344484923,
//                                20329.25761221804
//                            ],
//                            [
//                                1704348035861,
//                                20332.84038555903
//                            ],
//                            [
//                                1704351633537,
//                                20237.745087256495
//                            ],
//                            [
//                                1704355263489,
//                                19674.96844358097
//                            ],
//                            [
//                                1704358872926,
//                                19853.497523406244
//                            ],
//                            [
//                                1704362463230,
//                                19983.43487477359
//                            ],
//                            [
//                                1704366176259,
//                                19445.291521736264
//                            ],
//                            [
//                                1704369700839,
//                                18891.28456851808
//                            ],
//                            [
//                                1704373353887,
//                                18754.704534598844
//                            ],
//                            [
//                                1704376834370,
//                                18757.073507878278
//                            ],
//                            [
//                                1704380401462,
//                                18894.911677495384
//                            ],
//                            [
//                                1704384085422,
//                                19035.963431645465
//                            ],
//                            [
//                                1704387618972,
//                                17834.52334775019
//                            ],
//                            [
//                                1704391236298,
//                                18361.645399918907
//                            ],
//                            [
//                                1704394858197,
//                                18125.909982767433
//                            ],
//                            [
//                                1704398501464,
//                                17630.54050758189
//                            ],
//                            [
//                                1704402066847,
//                                16804.91507736701
//                            ],
//                            [
//                                1704405659871,
//                                16990.873296112033
//                            ],
//                            [
//                                1704409259413,
//                                17010.82141599485
//                            ],
//                            [
//                                1704412844703,
//                                17132.4521120325
//                            ],
//                            [
//                                1704416459768,
//                                17445.839355400494
//                            ],
//                            [
//                                1704420017621,
//                                17076.133444297397
//                            ],
//                            [
//                                1704423605355,
//                                17111.217626996237
//                            ],
//                            [
//                                1704427262503,
//                                17241.994906380096
//                            ],
//                            [
//                                1704430843711,
//                                17451.910389038425
//                            ],
//                            [
//                                1704434413368,
//                                17430.87624016792
//                            ],
//                            [
//                                1704438034865,
//                                17300.487621722154
//                            ],
//                            [
//                                1704441660559,
//                                17568.587098352764
//                            ],
//                            [
//                                1704445259466,
//                                17512.744101035376
//                            ],
//                            [
//                                1704448865869,
//                                17792.210816812512
//                            ],
//                            [
//                                1704452469136,
//                                17780.112255574793
//                            ],
//                            [
//                                1704456048277,
//                                17357.40561244542
//                            ],
//                            [
//                                1704459624806,
//                                17444.89618634333
//                            ],
//                            [
//                                1704463294246,
//                                16919.76703587195
//                            ],
//                            [
//                                1704466864461,
//                                16922.079908160817
//                            ],
//                            [
//                                1704470563927,
//                                16597.746110912016
//                            ],
//                            [
//                                1704474046493,
//                                16068.772895948448
//                            ],
//                            [
//                                1704477680028,
//                                16183.601487484495
//                            ],
//                            [
//                                1704481221811,
//                                16055.448967275517
//                            ],
//                            [
//                                1704484813214,
//                                16122.96794377126
//                            ],
//                            [
//                                1704488490817,
//                                16391.11615971529
//                            ],
//                            [
//                                1704492116318,
//                                16723.637884044936
//                            ],
//                            [
//                                1704495643370,
//                                16553.746956979987
//                            ],
//                            [
//                                1704499316469,
//                                16425.939433942498
//                            ],
//                            [
//                                1704502976843,
//                                16218.266649570229
//                            ],
//                            [
//                                1704506407196,
//                                16191.534179594986
//                            ],
//                            [
//                                1704510105830,
//                                16269.588797037593
//                            ],
//                            [
//                                1704513627319,
//                                16067.661061883278
//                            ],
//                            [
//                                1704517242043,
//                                16159.837750454459
//                            ],
//                            [
//                                1704520895312,
//                                16172.600703719556
//                            ],
//                            [
//                                1704524449670,
//                                15102.075805842027
//                            ],
//                            [
//                                1704528067788,
//                                15283.673173650393
//                            ],
//                            [
//                                1704531664595,
//                                15454.056835644391
//                            ],
//                            [
//                                1704535340849,
//                                15663.026618388762
//                            ],
//                            [
//                                1704538824254,
//                                15598.346907802055
//                            ],
//                            [
//                                1704542486765,
//                                15624.21611438164
//                            ],
//                            [
//                                1704546012955,
//                                15853.031259710613
//                            ],
//                            [
//                                1704549665530,
//                                16241.765904646387
//                            ],
//                            [
//                                1704553337298,
//                                16323.063074412075
//                            ],
//                            [
//                                1704556867902,
//                                16300.102147163276
//                            ],
//                            [
//                                1704560425037,
//                                16465.42411036323
//                            ],
//                            [
//                                1704564038135,
//                                16481.032536434683
//                            ],
//                            [
//                                1704567615859,
//                                16629.60072318998
//                            ],
//                            [
//                                1704571296072,
//                                16542.561902115114
//                            ],
//                            [
//                                1704574842982,
//                                16553.37250117215
//                            ],
//                            [
//                                1704578484361,
//                                16565.13168415472
//                            ],
//                            [
//                                1704582074529,
//                                16438.212893940763
//                            ],
//                            [
//                                1704585733392,
//                                16143.150976958139
//                            ],
//                            [
//                                1704589201993,
//                                16294.062058562798
//                            ],
//                            [
//                                1704592825624,
//                                16223.778400950772
//                            ],
//                            [
//                                1704596436401,
//                                16164.844044508964
//                            ],
//                            [
//                                1704600052255,
//                                16285.484246106402
//                            ],
//                            [
//                                1704603657539,
//                                16247.822773001084
//                            ],
//                            [
//                                1704607243389,
//                                16289.19531109132
//                            ],
//                            [
//                                1704610885280,
//                                16463.935127081775
//                            ],
//                            [
//                                1704614497615,
//                                16529.408607054844
//                            ],
//                            [
//                                1704618100471,
//                                16514.12647234989
//                            ],
//                            [
//                                1704621640539,
//                                16423.9757398516
//                            ],
//                            [
//                                1704625287154,
//                                16357.089904788307
//                            ],
//                            [
//                                1704628926039,
//                                16418.178703617144
//                            ],
//                            [
//                                1704632511486,
//                                16335.68616816902
//                            ],
//                            [
//                                1704636122461,
//                                16671.51321675796
//                            ],
//                            [
//                                1704639724959,
//                                16541.823805807275
//                            ],
//                            [
//                                1704643209222,
//                                16396.113669859442
//                            ],
//                            [
//                                1704646800677,
//                                16302.986854340654
//                            ],
//                            [
//                                1704650518877,
//                                16324.64962407013
//                            ],
//                            [
//                                1704654026070,
//                                16415.09549425188
//                            ],
//                            [
//                                1704657657314,
//                                16439.24517242531
//                            ],
//                            [
//                                1704661247373,
//                                16324.482217234645
//                            ],
//                            [
//                                1704664965667,
//                                16069.283999556204
//                            ],
//                            [
//                                1704668461447,
//                                15778.046404095456
//                            ],
//                            [
//                                1704672043581,
//                                15679.243956932762
//                            ],
//                            [
//                                1704675691260,
//                                15378.769726353687
//                            ],
//                            [
//                                1704679396313,
//                                15437.437793565574
//                            ],
//                            [
//                                1704682891960,
//                                15468.96177182448
//                            ],
//                            [
//                                1704686520241,
//                                14690.90645027028
//                            ],
//                            [
//                                1704690023142,
//                                15087.227598766778
//                            ],
//                            [
//                                1704693725466,
//                                15050.107610993353
//                            ],
//                            [
//                                1704697232183,
//                                15306.464040578474
//                            ],
//                            [
//                                1704700849681,
//                                15454.470003971519
//                            ],
//                            [
//                                1704704482818,
//                                15555.758025463268
//                            ],
//                            [
//                                1704708070194,
//                                15472.226117577151
//                            ],
//                            [
//                                1704711648717,
//                                15286.05184386631
//                            ],
//                            [
//                                1704715290412,
//                                15426.492786420433
//                            ],
//                            [
//                                1704718818156,
//                                15556.546100043473
//                            ],
//                            [
//                                1704722503688,
//                                15342.313599911222
//                            ],
//                            [
//                                1704726047405,
//                                15375.454109325137
//                            ],
//                            [
//                                1704729773509,
//                                15472.489705939055
//                            ],
//                            [
//                                1704733311864,
//                                15096.076257349445
//                            ],
//                            [
//                                1704736801857,
//                                15109.581377729652
//                            ],
//                            [
//                                1704740430091,
//                                15154.480993400493
//                            ],
//                            [
//                                1704744056936,
//                                15108.936329602368
//                            ]
//                        ]
                        
                        istotalBalanceChartDataLoaded = true

                    } catch APIError.invalidURL {
                        print("Invalid url")
                    } catch APIError.invalidResponse {
                        print("Invalid response")
                    } catch APIError.invalidData {
                        print("Invalid Data")
                    } catch {
                        // Handle other errors
                        print("An unexpected error")
                    }

                }

            }
            .onReceive(timer) { _ in
                Task {
                    totalBalance = 0
                    walletsInfo = []
                    do {
                        for address in addresses {
                            let walletInfo = try await fetchWalletInfo(walletAddress: address)
                            totalBalance += walletInfo.balanceInUSD
                            walletsInfo.append(walletInfo)
                        }
                    } catch APIError.invalidURL {
                        print("Invalid url")
                    } catch APIError.invalidResponse {
                        print("Invalid response")
                    } catch APIError.invalidData {
                        print("Invalid Data")
                    } catch {
                        // Handle other errors
                        print("An unexpected error")
                    }
                }
            }
            .onChange(of: addresses) { newValue in
                Task {
                    do {
                        let walletInfo = try await fetchWalletInfo(walletAddress: addresses[addresses.count - 1])
                        totalBalance += walletInfo.balanceInUSD
                        walletsInfo.append(walletInfo)
                    } catch APIError.invalidURL {
                        print("Invalid url")
                    } catch APIError.invalidResponse {
                        print("Invalid response")
                    } catch APIError.invalidData {
                        print("Invalid Data")
                    } catch {
                        // Handle other errors
                        print("An unexpected error")
                    }
                }
            }
        }

    }
}

struct ContentView_Previews: PreviewProvider {
    static var previews: some View {
        ContentView()
    }
}


